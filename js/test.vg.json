{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "description": "A bar chart showing the top 10 busiest train stations by annual ridership, filtered by train line.",
    "width": 600,
    "height": 400,
    "title": "Busiest Train Stations for selected lines (FY23-24)",
    "data": {
        "url": "https://raw.githubusercontent.com/JhonnyMonash/Week10Homework/refs/heads/main/data/Annual_Metropolitan_Train_Station_Entries_2023-24.csv"
    },
    "params": [
        {
            "name": "line_Alamein",
            "value": false
        },
        {
            "name": "line_Belgrave",
            "value": false
        },
        {
            "name": "line_City_Loop",
            "value": false
        },
        {
            "name": "line_Craigieburn",
            "value": false
        },
        {
            "name": "line_Cranbourne",
            "value": true
        },
        {
            "name": "line_Frankston",
            "value": false
        },
        {
            "name": "line_Glen_Waverley",
            "value": false
        },
        {
            "name": "line_Hurstbridge",
            "value": false
        },
        {
            "name": "line_Lilydale",
            "value": false
        },
        {
            "name": "line_Mernda",
            "value": false
        },
        {
            "name": "line_Pakenham",
            "value": false
        },
        {
            "name": "line_Sandringham",
            "value": false
        },
        {
            "name": "line_Sunbury",
            "value": false
        },
        {
            "name": "line_Upfield",
            "value": false
        },
        {
            "name": "line_Werribee",
            "value": false
        },
        {
            "name": "line_Williamstown",
            "value": false
        }
    ],
    "transform": [
        {
            "calculate": "split(datum.Line, /,\\s*/)",
            "as": "LineArray"
        },
        {
            "flatten": [
                "LineArray"
            ]
        },
        {
            "filter": "(line_Alamein && datum.LineArray == 'Alamein') || (line_Belgrave && datum.LineArray == 'Belgrave') || (line_City_Loop && datum.LineArray == 'City Loop') || (line_Craigieburn && datum.LineArray == 'Craigieburn') || (line_Cranbourne && datum.LineArray == 'Cranbourne') || (line_Frankston && datum.LineArray == 'Frankston') || (line_Glen_Waverley && datum.LineArray == 'Glen Waverley') || (line_Hurstbridge && datum.LineArray == 'Hurstbridge') || (line_Lilydale && datum.LineArray == 'Lilydale') || (line_Mernda && datum.LineArray == 'Mernda') || (line_Pakenham && datum.LineArray == 'Pakenham') || (line_Sandringham && datum.LineArray == 'Sandringham') || (line_Sunbury && datum.LineArray == 'Sunbury') || (line_Upfield && datum.LineArray == 'Upfield') || (line_Werribee && datum.LineArray == 'Werribee') || (line_Williamstown && datum.LineArray == 'Williamstown')"
        },
        {
            "sort": [
                {
                    "field": "Pax_annual",
                    "order": "descending"
                }
            ]
        },
        {
            "window": [
                {
                    "op": "rank",
                    "as": "rank"
                }
            ],
            "sort": [
                {
                    "field": "Pax_annual",
                    "order": "descending"
                }
            ],
            "groupby": [
                "Line"
            ]
        }
    ],
    "mark": "bar",
    "encoding": {
        "x": {
            "field": "Stop_name",
            "type": "ordinal",
            "sort": "-y",
            "axis": {
                "labelAngle": -45,
                "title": "Train Station"
            }
        },
        "y": {
            "field": "Pax_annual",
            "type": "quantitative",
            "axis": {
                "title": "Annual Ridership"
            }
        },
        "tooltip": [
            {
                "field": "Stop_name",
                "type": "ordinal",
                "title": "Train Station"
            },
            {
                "field": "Pax_annual",
                "type": "quantitative",
                "title": "Annual Ridership",
                "format": ",d"
            },
            {
                "field": "Line",
                "type": "ordinal",
                "title": "Train Line"
            }
        ]
    }
}